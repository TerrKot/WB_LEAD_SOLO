# WB Card JSON Link Generator + Parser

Утилита для работы с карточками товаров Wildberries: генерация ссылок на JSON API и получение нормализованных данных о товарах.

## Возможности

- Извлечение nmId из различных форматов ссылок WB
- Генерация прямых ссылок на JSON карточки товаров
- Получение и нормализация данных о товарах (цена, характеристики, бренд и т.д.)
- Обработка ошибок и retry логика для сетевых запросов

## Установка

```bash
# Windows
pip install -r requirements.txt

# Linux/Mac
pip3 install -r requirements.txt
# или
python3 -m pip install -r requirements.txt
```

## Как это работает

Утилита сначала пробует получить данные через публичные API эндпоинты Wildberries. Если они не работают (защищены PoW), автоматически переключается на **парсинг HTML страницы товара**.

Парсинг извлекает из страницы товара:

- **Название** товара
- **Цену** (текущую и старую)
- **Размеры упаковки**
- **Вес**
- **Описание**
- **Характеристики**

**Примечание:** Публичные API эндпоинты Wildberries защищены Proof of Work (PoW), поэтому утилита использует парсинг HTML как основной способ получения данных.

## Географические ограничения

**Важно:** Wildberries может блокировать доступ к публичным эндпоинтам и HTML страницам из других стран (не из России).

**Официальный API продавца:**

- ✅ Доступен из любой страны (нет географических ограничений)
- ❌ Но дает доступ только к своим товарам (не ко всем товарам на WB)

**Публичные эндпоинты (card.wb.ru):**

- ⚠️ Могут блокироваться для IP из других стран
- ⚠️ Защищены PoW (Proof of Work)
- ⚠️ Могут требовать российский IP

**HTML страницы:**

- ⚠️ Могут блокироваться антибот защитой (статус 498)
- ⚠️ Могут требовать российский IP

**Если вы находитесь за пределами России:**

- Попробуйте использовать VPN/прокси с российским IP
- Добавьте задержки между запросами
- Утилита автоматически попробует все доступные методы

## Использование

Запустите утилиту в интерактивном режиме:

```bash
# Windows
python cli.py

# Linux/Mac
python3 cli.py
```

После запуска вы увидите приглашение для ввода. Можете вводить:

### Просто ссылку или артикул (получение данных)

```
WB > 12345678
```

или

```
WB > https://www.wildberries.ru/catalog/12345678/detail.aspx
```

Результат:

```json
{
  "nmId": 12345678,
  "name": "Название товара",
  "brand": "Бренд",
  "price": 1299.0,
  "priceOld": 1999.0,
  "discountPercent": 35.0,
  "currency": "RUB",
  "weight": "500 г",
  "dimensions": "20x15x10 см",
  "description": "Описание товара...",
  "characteristics": {
    "Материал": "Хлопок",
    "Цвет": "Черный"
  }
}
```

### Только генерация ссылки

```
WB > link:12345678
```

Результат:

```json
{
  "nmId": 12345678,
  "jsonUrl": "https://card.wb.ru/cards/detail?appType=1&curr=rub&dest=-1257786&regions=80,64,83,4,38,33,70,69,86,30,40,48,1,66,31,22&spp=0&nm=12345678;"
}
```

### Команды

- `help` или `h` - показать справку
- `exit`, `quit` или `q` - выйти из программы
- `Ctrl+C` - прервать выполнение и выйти

## Поддерживаемые форматы входных данных

- `https://www.wildberries.ru/catalog/<nmId>/detail.aspx`
- `https://www.wildberries.ru/catalog/<nmId>/detail.aspx?targetUrl=...`
- Просто число `<nmId>`

## Требования

- Python 3.10+
- requests
- urllib3

## Обработка ошибок

Утилита обрабатывает следующие типы ошибок:

- **InvalidInputError**: Невалидный формат входных данных
- **NotFoundError**: Товар не найден
- **NetworkError**: Ошибки сети (таймауты, проблемы с подключением)

## Технические детали

- **Публичные JSON-эндпоинты**: Использует публичные эндпоинты Wildberries (не требуют API-ключа)
  - Основной: `https://card.wb.ru/cards/detail` (публичный JSON-эндпоинт для детальной информации о товаре)
  - Альтернативные: `basket-*.wb.ru` (внутренние распределенные серверы)
- **Автоматическое переключение**: При недоступности одного эндпоинта автоматически пробует другие
- **Таймауты**: connect=5 сек, read=10 сек
- **Retry**: 3 попытки с экспоненциальной паузой
- **Логирование**: через стандартный модуль logging

## Используемые эндпоинты

Утилита использует публичные JSON-эндпоинты Wildberries, которые не требуют API-ключа:

- `card.wb.ru/cards/detail` - основной эндпоинт для получения детальной информации о товаре
  - Параметры: `appType=1`, `curr=rub`, `dest=-1257786`, `regions=...`, `spp=0`, `nm={nmId};`
  - Возвращает: цены, скидки, остатки, бренд, название, рейтинг, отзывы
- `basket-*.wb.ru` - альтернативные внутренние серверы (используются как fallback)

⚠️ Эти эндпоинты не являются официальным API, но широко применяются для парсинга и анализа рынка.
⚠️ Обратите внимание: эндпоинт `/cards/detail` (без v1) - это правильный формат согласно документации.
