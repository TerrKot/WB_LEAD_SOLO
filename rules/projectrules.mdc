---
description: –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞ —ç–∫—Å–ø—Ä–µ—Å—Å-–æ—Ü–µ–Ω–∫–∏ –∏ —Ä–∞—Å—á—ë—Ç–∞ –±–µ–ª–æ–π –ª–æ–≥–∏—Å—Ç–∏–∫–∏ vs –∫–∞—Ä–≥–æ (WB)
globs:
alwaysApply: true
---

## –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Cursor (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, Docker / Docker Compose
- Redis –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π, —Å—Ç–∞—Ç—É—Å–æ–≤, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- PostgreSQL –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—á—ë—Ç–æ–≤)
- –í—ã—Å–æ–∫–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —É–∑–∫–∏—Ö –º–µ—Å—Ç
- –ï–¥–∏–Ω—ã–π `calculation_id` —Å–∫–≤–æ–∑—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É

### –û—á–µ—Ä–µ–¥–∏ –∏ –≤–æ—Ä–∫–µ—Ä—ã
- –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Redis –æ—á–µ—Ä–µ–¥–∏ (`calculation_queue`, `gpt_queue`)
- –°—Ç–∞—Ç—É—Å—ã —Ä–∞—Å—á—ë—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis (`calculation:{calculation_id}:status`)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis —Å TTL (24 —á–∞—Å–∞)
- –í–æ—Ä–∫–µ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–¥–∞—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

### GPT API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **–ü–æ–¥–±–æ—Ä –≤–µ—Å–∞/–æ–±—ä—ë–º–∞:** –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ GPT API (—Å—Ç—Ä–æ–≥–æ JSON-–æ—Ç–≤–µ—Ç)
- **–ü–æ–¥–±–æ—Ä –¢–ù –í–≠–î:** –∑–∞–ø—Ä–æ—Å –∫ GPT API –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∫–æ–¥–∞ –¢–ù –í–≠–î, —Ç–∏–ø–∞ –ø–æ—à–ª–∏–Ω—ã, —Å—Ç–∞–≤–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞ ifcg.ru)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–∞–Ω–∂–µ–≤–æ–π –∑–æ–Ω—ã:** GPT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞), —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: `{"pass": 0 | 1, "reason": "string"}`
- **–í–æ –≤—Å–µ—Ö GPT-–≤—ã–∑–æ–≤–∞—Ö:** –Ω–µ—Ç —Ñ–æ–ª–ª–±—ç–∫–æ–≤, –ª–∏–±–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON-–æ—Ç–≤–µ—Ç, –ª–∏–±–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–æ–≤
- **–†–∞—Å—á—ë—Ç –∫–∞—Ä–≥–æ:** —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ `rules/Cargo.md`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω—ã –¢–ù –í–≠–î:** —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ `rules/TN VED RED ZONE RULES.json`
- **–†–∞—Å—á—ë—Ç –±–µ–ª–æ–π –ª–æ–≥–∏—Å—Ç–∏–∫–∏:** —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (1000 –∫–≥ / 4.6 –º¬≥ ‚Üí 1850 USD), –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç (–¶–ë + 2%), –¥–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã (–¥–æ–∫—É–º–µ–Ω—Ç—ã: 15 000 ‚ÇΩ, –±—Ä–æ–∫–µ—Ä: 25 000 ‚ÇΩ)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–æ—Ä—Ç—ã
- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî —á–µ—Ä–µ–∑ ENV (—Å–º. `.env.example`).
- **BOT_TOKEN** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
- **GPT_API_KEY** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, API –∫–ª—é—á OpenAI
- **REDIS_URL** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã: `5433`, `6379`, `8000‚Äì8008`, `8010‚Äì8023`, `9000`, `8125:8000`, `8075`, `8090`.
- Health/webhook –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ `8443` (–≤–Ω–µ—à–Ω–∏–π), `8444` (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

### –ü–∞—Ä—Å–∏–Ω–≥ WB
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –∏–∑ `scripts/wb_parser.py` (–∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ —Å–µ—Ä–≤–∏—Å)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∞ –≤ `rules/API_SCHEMA_DOCUMENTATION.md`
- –ü–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ–±—è–∑–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å

### –õ–æ–≥–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –õ–æ–≥–∏ ‚Äî JSON, –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É). –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `calculation_id`, `user_id`, `event_type`, `event_id`.
- PII –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º.
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É–µ–º —Å —É—Ä–æ–≤–Ω–µ–º ERROR –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –¢–µ—Å—Ç—ã –∏ CI
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: `pytest`, `ruff`, `black`.
- –ü–µ—Ä–µ–¥ merge –ø—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –ø–∞—Ä—Å–∏–Ω–≥ WB, —Ä–∞—Å—á—ë—Ç –∫–∞—Ä–≥–æ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¢–ù –í–≠–î —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### Roadmap
- –°–ª–µ–¥—É–π –∑–∞–¥–∞—á–∞–º –∏–∑ `rules/ROADMAP.md`. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω out-of-band —à–∞–≥ ‚Äî —è–≤–Ω–æ —Å–æ–≥–ª–∞—Å—É–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π roadmap –ø–∏—à–∏ ¬´üîÑRoadmap has been updated¬ª.

---

## PROTECTED: –ü—Ä–∞–≤–∏–ª–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- `Cargo.md` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ –∫–∞—Ä–≥–æ
- `TN VED RED ZONE RULES.json` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω—ã –¢–ù –í–≠–î
- `API_SCHEMA_DOCUMENTATION.md` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Wildberries API v4
- `scripts/wb_parser.py` ‚Äî –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ WB

–õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ª–∂–Ω—ã –æ–±—Å—É–∂–¥–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è)
```
apps/bot_service/        # Telegram –±–æ—Ç + —Å–µ—Ä–≤–∏—Å—ã
apps/bot_service/workers/ # –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π
scripts/                 # wb_parser.py, init_db.py
infra/docker/            # Dockerfile/compose
rules/                   # –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## –ö–æ–¥-—Å—Ç–∞–π–ª
- Python: ruff + black (PEP8). –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–∫–æ–¥), –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
- –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Äî ASCII.
- Commit messages: `feat:`, `fix:`, `docs:`, `chore:`.

---

## –ó–∞–ø—Ä–µ—Ç—ã (–ø–æ–≤—Ç–æ—Ä)
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ (–≤—Å–µ —Ä–∞—Å—á—ë—Ç—ã —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏)
- ‚ùå –•–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤—Å—ë —á–µ—Ä–µ–∑ `.env`)
- ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `Cargo.md` –∏ `TN VED RED ZONE RULES.json`
- ‚ùå GPT –∫–∞–∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ –≤ –æ—Ä–∞–Ω–∂–µ–≤–æ–π –∑–æ–Ω–µ (—Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- ‚ùå –§–æ–ª–ª–±—ç–∫–∏ –≤ GPT-–≤—ã–∑–æ–≤–∞—Ö
- ‚ùå –•–∞—Ä–¥–∫–æ–¥ –∫–ª—é—á–µ–π, —Ç–æ–∫–µ–Ω–æ–≤, URL Redis
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ ¬´–∑–∞–≥–ª—É—à–µ–∫¬ª
- ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å Roadmap –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## –ü—Ä–æ—Ü–µ—Å—Å—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
1. –ò–∑–º–µ–Ω–∏—Ç—å `.env` –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å –∏ –≤–æ—Ä–∫–µ—Ä—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
1. –û–ø–∏—Å–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `ARCHITECTURE.md` (–µ—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –≤ `apps/bot_service/services/`
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
4. –û–±–Ω–æ–≤–∏—Ç—å `IMPLEMENTATION_GUIDE.md` –∏ `ROADMAP.md` (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### –†–∞–±–æ—Ç–∞ —Å –æ—á–µ—Ä–µ–¥—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ–º Redis –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
- –í–æ—Ä–∫–µ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–¥–∞—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –°—Ç–∞—Ç—É—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis —Å TTL

---

–°–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –õ—é–±–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–π –≤ MR/–æ—Ç–≤–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
